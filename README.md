# Описание проекта

Для реализации проекта использовались следующие компоненты:
- **Sublime Text** – для написания кода Python.
- **PostgreSQL** – для хранения стейджинговых данных, фактовых и исторических данных, витрины мошеннических операций.
- **Терминал** – для создания виртуального окружения, установки библиотек (`pip install psycopg2-binary pandas sqlalchemy openpyxl`), запуска и отладки ETL-процесса.

## ETL-процесс

В ходе ETL-процесса данные из файлов `csv` и `xlsx` загружаются в промежуточные таблицы:
- `stg_transactions`
- `stg_terminals`
- `stg_passport_blacklist`

После обработки файлы перемещаются в архив с добавлением временной метки к имени файла. Это позволяет определить, когда каждый файл был обработан, и восстановить историю изменений.

Данные из стейджинговых таблиц преобразуются и загружаются в хранилище:
- `dwh_dim_terminals_hist` (таблица терминалов с поддержкой истории изменений)
- `dwh_fact_transactions` (фактовая таблица транзакций)
- `dwh_fact_passport_blacklist` (фактовая таблица паспортов из черного списка)

Для терминалов, параметры которых изменились, закрывается старая запись и создается новая с актуальными данными. Терминал помечается как удаленный, если он отсутствует в текущей stg-таблице терминалов.

На всех этапах ETL-процесса фиксируются ошибки и метаданные (время начала и завершения процесса, статус выполнения).

## Запуск проекта

Предполагается, что пользователь при первом запуске кода введет параметры для подключения к БД. При каждом запуске кода `main.py` необходимо ввести дату в формате `DDMMYYYY` – после этого формируются пути к файлам терминалов, транзакций и черного списка паспортов.

Код запускается трижды с датами:
- `01032021`
- `02032021`
- `03032021`

Базовые запросы для проверки результатов ETL-процесса собраны в файле `check_result.sql`.

## Структура проекта

Структуру проекта можно схематично представить так:

```
├── data/ # Папка с исходными данными
│   ├── transactions_01032021.txt
│   ├── transactions_02032021.txt
│   ├── transactions_03032021.txt
│   ├── terminals_01032021.xlsx
│   ├── terminals_02032021.xlsx
│   ├── terminals_03032021.xlsx
│   ├── passport_blacklist_01032021.xlsx
│   ├── passport_blacklist_02032021.xlsx
│   └── passport_blacklist_03032021.xlsx
│
├── archive/ # Архивная папка для обработанных файлов
│
├── sql_scripts/ # Папка с SQL-скриптами
│   ├── create_cards_accounts_clients.sql # Создание таблиц карт, счетов и клиентов
│   ├── create_bank_tables.sql # Создание остальных таблиц
│   ├── load_to_warehouse.sql # Загрузка данных в хранилище
│   ├── update_hist_terminals.sql # Обновление исторических записей терминалов
│   └── build_fraud_report.sql # Построение витрины мошеннических операций
│
└── main.py # Основной код    
```
